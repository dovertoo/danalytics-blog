<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dan Overtoom">
<meta name="dcterms.date" content="2022-08-12">

<title>Visualizing Assist Networks in Lacrosse – danalytics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-e31584831b205ffbb2d98406f31c2a5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">danalytics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/dovertoo/danalytics"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/danovertoom"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Visualizing Assist Networks in Lacrosse</h1>
            <p class="subtitle lead"></p><p>Using the <code>igraph</code> and <code>ggraph</code> packages to explore and visualize Assist Networks in Men’s and Women’s D1 lacrosse.</p><p></p>
                                <div class="quarto-categories">
                <div class="quarto-category">Lacrosse</div>
                <div class="quarto-category">Data Viz</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://danalytics.blog">Dan Overtoom</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 12, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-assist-networks" id="toc-why-assist-networks" class="nav-link active" data-scroll-target="#why-assist-networks">Why Assist Networks?</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a>
  <ul class="collapse">
  <li><a href="#gather-and-clean-data" id="toc-gather-and-clean-data" class="nav-link" data-scroll-target="#gather-and-clean-data">Gather and Clean Data</a></li>
  <li><a href="#create-network-object" id="toc-create-network-object" class="nav-link" data-scroll-target="#create-network-object">Create Network Object</a>
  <ul class="collapse">
  <li><a href="#network-nodes" id="toc-network-nodes" class="nav-link" data-scroll-target="#network-nodes">Network Nodes</a></li>
  <li><a href="#network-links" id="toc-network-links" class="nav-link" data-scroll-target="#network-links">Network Links</a></li>
  <li><a href="#nodes-links-network" id="toc-nodes-links-network" class="nav-link" data-scroll-target="#nodes-links-network">Nodes + Links = Network</a></li>
  </ul></li>
  <li><a href="#plot-network" id="toc-plot-network" class="nav-link" data-scroll-target="#plot-network">Plot Network</a>
  <ul class="collapse">
  <li><a href="#base-layer" id="toc-base-layer" class="nav-link" data-scroll-target="#base-layer">Base Layer</a></li>
  <li><a href="#node-layer" id="toc-node-layer" class="nav-link" data-scroll-target="#node-layer">Node Layer</a></li>
  <li><a href="#links-layer" id="toc-links-layer" class="nav-link" data-scroll-target="#links-layer">Links Layer</a></li>
  <li><a href="#node-label-layer" id="toc-node-label-layer" class="nav-link" data-scroll-target="#node-label-layer">Node Label Layer</a></li>
  <li><a href="#styling-layer-full-plot" id="toc-styling-layer-full-plot" class="nav-link" data-scroll-target="#styling-layer-full-plot">Styling Layer &amp; Full Plot</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#function-workflow-examples" id="toc-function-workflow-examples" class="nav-link" data-scroll-target="#function-workflow-examples">Function Workflow &amp; Examples</a></li>
  <li><a href="#so-now-what" id="toc-so-now-what" class="nav-link" data-scroll-target="#so-now-what">So Now What?</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>The most exciting aspect of sports (in my opinion) is watching players score. Even die-hard fans of great defense must admit that the excitement of a defensive stop comes from preventing an opposing player from scoring. A high powered offense is a sight to be seen. In free-flowing sports scores can come from excellent individual effort, precision passing leading to a catch and score, or as is often the case a combination of the two.</p>
<p><img src="https://media.giphy.com/media/3o72F93I0BhqFXAdi0/giphy.gif" class="img-fluid"></p>
<p>Today we are going to focus on passing. Specifically, assists or the successful passes that lead directly to a score. When watching free-flowing sports such as basketball, hockey and lacrosse, fans will be well aware of the players that execute passes which make it possible for other players to score. An observant fan may take note of which players have a particularly productive passing-scoring relationship throughout a game or a season. An even deeper level of fan may wonder how players and teams work together through passing to scoring. Then to take it a step further ask questions such as how effective are these scoring relationships? And, how do they grow and develop throughout a game/season either based on team philosophy, chemistry or matchups?</p>
<p>For those fans…allow me to introduce you to <strong><em>Assist Networks</em></strong>.</p>
<section id="why-assist-networks" class="level1">
<h1>Why Assist Networks?</h1>
<p>The concept of Assist Networks was introduced to me by Positive Residual (<a href="https://twitter.com/presidual">@presidual</a>) on Twitter. I highly recommend checking out their <a href="https://positiveresidual.com/">site</a> for a range of basketball analytics and data visualizations, whether you are a basketball fan or just an analytics fan or even both. When I saw this method of visualizing the assister-shooter combinations observed in an NBA basketball game, my eyes lit up with desire to apply this concept to the sport I love - lacrosse!</p>
<p>The ability to visually show the relationships between players who throw passes that lead to goals is immensely valuable when attempting to understand how teammates interact effectively. While there are constant interactions between players on the field (both direct and indirect), assist networks focus on “successful passing interactions”. In this case we define a successful passing interaction as a pass that directly aides in the recipient scoring a goal, i.e.&nbsp;an assist. Charting these interactions within a team gives us insight on the identity of the team’s offense. We can quickly see how reliant a team is on having passes generate scoring. Taking it a step further we can see who the main offensive contributors are from both a passing and scoring perspective.</p>
<p>Using assist networks, we will attempt to better understand the teammate-to-teammate passing interactions that ultimately lead to a goal being scored. When focusing in on a single game’s assist data, we can quickly see how effective or ineffective a team was at generating successful passing interactions against a specific defense. While a single game can answer some questions, it can also generate more questions. Such as:</p>
<ul>
<li>Was this result strictly matchup based?</li>
<li>Is this result “matchup proof”?</li>
<li>Will these teammate interactions grow stronger or evolve into something different?</li>
</ul>
<p>To answer these questions and more, we can look at assist networks from game to game, across a season, for a team’s season as a whole, all games against a certain defense, as well as focusing on a certain player or group of players over multiple seasons. Taking a deeper look into the assist network characteristics of a team can lead to a greater understanding of the team’s style and philosophy. Looking at the assist networks for a team year-over-year can show how team strategies change (or don’t change) based on player movement and players growing and developing.</p>
<p>Now that we have an idea of questions assist networks can help us answer, let’s build some assist networks. All data in this post is supplied by <a href="https://lacrossereference.com/">Lacrosse Reference</a> and can be easily accessed using their PRO subscription. I highly recommend subscribing and checking out their site. They have something for every lacrosse fan whether you want to keep track of a certain team or player or further your lacrosse knowledge by diving deep into the statistics.</p>
</section>
<section id="methodology" class="level1">
<h1>Methodology</h1>
<p>igraph + ggraph = assist networks</p>
<p>There are two key packages that we will utilize to create the network visualizations - <code>igraph</code> and <code>ggraph</code>. The network object is created with <code>igraph::graph_from_data_frame</code> and then plot using <code>ggraph</code> and the associated family of functions. While network objects can be plotted directly with <code>igraph</code>, in this post we choose to stick to the more familiar plotting framework of <code>ggraph</code>. As the name suggests <code>ggraph</code> uses the grammar that <code>ggplot2</code> users have come to know and love.</p>
<p>The basic network visualization workflow we follow is:</p>
<ol type="1">
<li>Gather and clean data from <a href="https://lacrossereference.com/">Lacrosse Reference</a></li>
<li>Create network nodes and links that form Network object (<code>igraph</code>)</li>
<li>Plot the network (<code>ggraph</code>)</li>
</ol>
<p>Let’s get started by loading our data cleaning packages:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="gather-and-clean-data" class="level2">
<h2 class="anchored" data-anchor-id="gather-and-clean-data">Gather and Clean Data</h2>
<p>While a Lacrosee Reference PRO subscription does not grant you direct database access, it does give you the next best thing - a GUI to query their database! So, we head over to <a href="https://pro.lacrossereference.com/">Lacrosse Reference</a> to grab all our data. For this exercise we are focused on the 2022 season. So we will download the CSV files for players, teams, games and assists data from both Men’s and Women’s DI Lacrosse for the 2022 season and bring them into our R session (please note for the purposes of this post we are only using a partial data pull).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>players_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data_players_2022.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>teams_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data_teams.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>games_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data_games_2022.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>assist_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data_assists_2022.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Since this data is taken from a database, we need to clean it up a bit. The data is scrapped from the NCAA play by play logs and therefore has some imperfections. A major imperfection is that some records are duplicated; therefore, we must be sure to filter them out. We will use the players, teams and games data to “de-code” the player, team and game id’s in the assist data so we can easily access the assist data we want for our network.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#clean up player data into player list with player_id</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cahnge player name from full name to first initial last name for plot labeling purposes</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>players_data <span class="ot">&lt;-</span> players_data <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">player_id =</span> id) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(player, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"player_first"</span>, <span class="st">"player_last"</span>), <span class="at">extra =</span> <span class="st">"merge"</span>, <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">player =</span> <span class="fu">paste0</span>(<span class="fu">str_sub</span>(player_first, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">1</span>), <span class="st">". "</span>, player_last)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(player, player_id)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#clean up teams data </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>teams_data <span class="ot">&lt;-</span> teams_data <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">team_id =</span> id) <span class="sc">%&gt;%</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>league)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#clean up games data with help of teams data</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>games_data <span class="ot">&lt;-</span> games_data <span class="sc">%&gt;%</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">game_id =</span> id) <span class="sc">%&gt;%</span> </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., teams_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"home_id"</span> <span class="ot">=</span> <span class="st">"team_id"</span>)) <span class="sc">%&gt;%</span> <span class="co">#add home team name, etc.</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">home_team_short =</span> short_code, <span class="at">home_team =</span> display_name) <span class="sc">%&gt;%</span> </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., teams_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"away_id"</span> <span class="ot">=</span> <span class="st">"team_id"</span>)) <span class="sc">%&gt;%</span> <span class="co">#add away team name, etc.</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">away_team_short =</span> short_code, <span class="at">away_team =</span> display_name)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">#clean up assist data using clean players, teams and games data</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>assist_data <span class="ot">&lt;-</span> assist_data <span class="sc">%&gt;%</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., players_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"shooter_id"</span> <span class="ot">=</span> <span class="st">"player_id"</span>)) <span class="sc">%&gt;%</span> <span class="co">#add shooter name</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">shooter =</span> player) <span class="sc">%&gt;%</span> </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., players_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"assister_id"</span> <span class="ot">=</span> <span class="st">"player_id"</span>)) <span class="sc">%&gt;%</span> <span class="co">#add assister name</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">assister =</span> player) <span class="sc">%&gt;%</span> </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., games_data, <span class="at">by =</span> <span class="st">"game_id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="co">#verify that no duplicates are in the data</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now that we have clean assist data for both leagues for the 2022 season, we can begin to construct an assist network plot. The question now is how to select a game of interest. There a variety of factors that go into an “interesting” game for assist data. Maybe you are clamoring for me to choose a game that involves your favorite team, or one your favorite players performed particularly well in or perhaps you have a specific question you want answered with data. All of these are great ideas and assist networks can meet all of those desires and more. For the purposes of this demo we are going to look for a game with <em>many</em> assists and assister-shooter combinations so we can see the full power of an assist network. Let’s take a peek into the assist data and see what we can find.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(assist_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,284
Columns: 29
$ possession_seq       &lt;dbl&gt; 1, 1, 2, 2, 1, 1, 1, 1, 4, 1, 1, 2, 1, 2, 3, 1, 1…
$ game_state           &lt;dbl&gt; 0, 1, -3, -2, 2, 3, 4, 5, -6, 2, 4, 6, -8, -7, -6…
$ goalie_id            &lt;int&gt; 2132, 2132, 420, 420, 2132, 2132, 2132, 2132, 420…
$ shooter_id           &lt;int&gt; 424, 17034, 16956, 1623, 433, 1660, 424, 428, 216…
$ possession_elapsed   &lt;dbl&gt; 14, 58, 24, 12, 0, 36, 28, 64, 66, 38, 51, 12, 14…
$ man_up               &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0…
$ team_id              &lt;int&gt; 56, 56, 53, 53, 56, 56, 56, 56, 53, 37, 37, 37, 3…
$ assister_id          &lt;int&gt; 431, 428, 16959, 16959, 17034, 433, 428, 429, 169…
$ time_elapsed         &lt;dbl&gt; 14, 811, 1049, 1061, 2100, 2341, 2369, 2464, 3221…
$ team_odds            &lt;dbl&gt; 0.573, 0.738, 0.281, 0.476, 0.823, 0.881, 0.937, …
$ game_id              &lt;int&gt; 10044, 10044, 10044, 10044, 10044, 10044, 10044, …
$ shot_clock_remaining &lt;dbl&gt; 66, 20, 67, 68, 46, 34, 52, 4, 34, 39, 29, 75, 66…
$ shooter              &lt;chr&gt; "S. Goldsmith", "T. Dooley", "D. Macdonald", "B. …
$ assister             &lt;chr&gt; "N. Rockefeller", "C. Klepper", "C. Della Rocco",…
$ status               &lt;chr&gt; "completedFromNCAA", "completedFromNCAA", "comple…
$ league               &lt;chr&gt; "NCAA D1 Men", "NCAA D1 Men", "NCAA D1 Men", "NCA…
$ pregame_home_wp      &lt;dbl&gt; 0.568228, 0.568228, 0.568228, 0.568228, 0.568228,…
$ away_id              &lt;int&gt; 53, 53, 53, 53, 53, 53, 53, 53, 53, 36, 36, 36, 3…
$ traversals_70_30     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1…
$ tension_game_score   &lt;dbl&gt; 75, 75, 75, 75, 75, 75, 75, 75, 75, 200, 200, 200…
$ home_id              &lt;int&gt; 56, 56, 56, 56, 56, 56, 56, 56, 56, 37, 37, 37, 3…
$ elo_transfer         &lt;dbl&gt; 17.300, 17.300, 17.300, 17.300, 17.300, 17.300, 1…
$ home_score           &lt;int&gt; 9, 9, 9, 9, 9, 9, 9, 9, 9, 21, 21, 21, 21, 21, 21…
$ game_date            &lt;chr&gt; "2022-01-29", "2022-01-29", "2022-01-29", "2022-0…
$ away_score           &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 12, 12, 12, 12, 12, 12…
$ home_team_short      &lt;chr&gt; "MER", "MER", "MER", "MER", "MER", "MER", "MER", …
$ home_team            &lt;chr&gt; "Mercer", "Mercer", "Mercer", "Mercer", "Mercer",…
$ away_team_short      &lt;chr&gt; "BELL", "BELL", "BELL", "BELL", "BELL", "BELL", "…
$ away_team            &lt;chr&gt; "Bellarmine", "Bellarmine", "Bellarmine", "Bellar…</code></pre>
</div>
</div>
<p>Alright, that is a lot of information and a good chunk of assists to sort though. Let’s count the total number of assister-shooter combinations and the number of <em>unique</em> assister-shooter combinations for each game. Since assist networks are focused on a single team we will do this by both home and away team so that we get counts on the team-game level.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>home_game_assist_info <span class="ot">&lt;-</span> assist_data <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(team_id <span class="sc">==</span> home_id) <span class="sc">%&gt;%</span> <span class="co">#gather records for home team only</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(game_id, home_team, league) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(assister, shooter) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_assists =</span> <span class="fu">sum</span>(n), <span class="at">num_assist_combos =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_assists))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(home_game_assist_info)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
# Groups:   game_id, home_team [6]
  game_id home_team  league      total_assists num_assist_combos
    &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;               &lt;int&gt;             &lt;int&gt;
1   10159 Mercer     NCAA D1 Men            21                17
2   10093 Bucknell   NCAA D1 Men            19                18
3   10162 VMI        NCAA D1 Men            19                19
4   10350 Boston U   NCAA D1 Men            18                15
5   10012 Georgetown NCAA D1 Men            16                14
6   10014 Georgetown NCAA D1 Men            16                16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>away_game_assist_info <span class="ot">&lt;-</span> assist_data <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(team_id <span class="sc">==</span> away_id) <span class="sc">%&gt;%</span> <span class="co">#gather records for away team only</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(game_id, away_team, league) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(assister, shooter) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_assists =</span> <span class="fu">sum</span>(n), <span class="at">num_assist_combos =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_assists))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(away_game_assist_info)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
# Groups:   game_id, away_team [6]
  game_id away_team    league      total_assists num_assist_combos
    &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;               &lt;int&gt;             &lt;int&gt;
1   10158 Richmond     NCAA D1 Men            18                16
2   10194 Jacksonville NCAA D1 Men            17                16
3   10352 Yale         NCAA D1 Men            17                13
4   10172 LIU          NCAA D1 Men            16                11
5   10259 Penn         NCAA D1 Men            16                11
6   10297 Vermont      NCAA D1 Men            16                16</code></pre>
</div>
</div>
<p>Some perhaps unexpected names at the top of the list, which makes this exercise all the more interesting. There is no wrong game to pick, and it is understandable to want to start plotting all of them. Like any good cooking show, we have a beautiful cake waiting in the oven for you. Let’s pick the Penn vs.&nbsp;Princeton overtime thriller and look at the assist network for the cardiac Quakers.</p>
</section>
<section id="create-network-object" class="level2">
<h2 class="anchored" data-anchor-id="create-network-object">Create Network Object</h2>
<p>Our data is clean. We have selected the game and the team we would like to analyze the assist network for. Let’s create our network object using the <code>igraph</code> package.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A network object consists of two major pieces: nodes and links. For the purpose of assist networks, our nodes will be players that were either the assister or shooter in the assist interactions and our links will represent the frequency of those interactions between two players.</p>
<p>Let’s gather our network data by filtering our clean assist data to only the records for Penn from the Penn vs.&nbsp;Princeton game on March 19<sup>th</sup>, 2022.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we take the game id from our away_game_assist_info tbl and select only Penn records</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>penn_ntwk_data <span class="ot">&lt;-</span> assist_data <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(game_id <span class="sc">==</span> <span class="dv">10259</span> <span class="sc">&amp;</span> team_id <span class="sc">==</span> away_id)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now we are ready to create our network nodes and links!</p>
<section id="network-nodes" class="level3">
<h3 class="anchored" data-anchor-id="network-nodes">Network Nodes</h3>
<p>The nodes of a network (also referred to as vertices) serve as the beginning points or endpoints (or both) of the interaction you are analyzing. In the case of an assist interaction, nodes are defined as either the player scoring the goal (shooter) or the player that is credited with the assist (assister). Therefore, we want our nodes dataframe to include all players that were either assisters or shooters in the game with no duplicates. When creating our nodes dataframe, we want the first column to consist of all node IDs (assisters/shooters) and all subsequent columns can contain node attributes. In this case our node attributes include:</p>
<ul>
<li><strong>num_interactions</strong> - the number of interactions for a player. We define this as the number of assisted scoring plays the player is a part of, which is also the sum of their assists and goals (referred to as points in lacrosse).</li>
<li><strong>num_assists</strong> - the number of assists a player recorded in the game.</li>
<li><strong>player_name</strong> - the player name associated with the node. In our case this column is a duplicate of the node id column. This is necessary to use the player’s name as both a node id and a node attribute.</li>
</ul>
<p>This node dataframe contains the information we need to begin building the network as well as some key attributes that will add context to our network visualization. Below is the code to create the network nodes dataframe:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>penn_cnt_assists <span class="ot">&lt;-</span> penn_ntwk_data <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(assister) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(assister) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">num_assists =</span> n)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>penn_ntwk_nodes <span class="ot">&lt;-</span> penn_ntwk_data <span class="sc">%&gt;%</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(assister, shooter) <span class="sc">%&gt;%</span> <span class="co">#need to have all shooters/assisters listed as vertices</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">"assister_shooter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(assister_shooter) <span class="sc">%&gt;%</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">num_interactions =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., penn_cnt_assists, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"assister_shooter"</span> <span class="ot">=</span> <span class="st">"assister"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_assists =</span> <span class="fu">replace_na</span>(num_assists, <span class="dv">0</span>)) <span class="sc">%&gt;%</span>         </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span>         </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">player_name =</span> assister_shooter)        </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Network Nodes are ready to go! Time to link them up.</p>
</section>
<section id="network-links" class="level3">
<h3 class="anchored" data-anchor-id="network-links">Network Links</h3>
<p>The links of a network show how the nodes connect (or don’t connect) to each other. Network links can be directed (typically with an arrow to denote where link starts and ends) or un-directed, based on the nature of the interaction being described. For our assist network, we want to show which node is the assister and which node is the shooter. The link starting at the assister and ending with an arrow pointing to the shooter, provides a logical visual representation of the assist interaction. Within a game environment, it is not uncommon that players would classified as both an assister and a shooter. So, we expect to see two-way interactions in our networks (this also adds another layer of analysis to observe the amount of two-way interactions or lack thereof). In the case that two players assisted each other, the link will be shown with an arrow on each end to indicate each player received an assist from the other.</p>
<p>It is common that a player may assist another player multiple times over the course of a game. When we go to visualize these, we can choose to either show a link for every connection between the two players or show the link once and add a label to show the number of times the link occurred. We will go the route of showing a link with a number denoting the frequency in order to have a cleaner looking visualization. Therefore, we want to create a dataframe that shows each assister-shooter combination with the frequency of each. Since it is redundant to label links that only occur once, we will filter this dataframe to include frequencies greater than one. Now, we are ready to create our network links dataframe. Similarly to our network links dataframe, the first two columns of the network links dataframe will be populated with the network link IDs. The first column should contain the node ID where the link will start, with the second column indicating the node ID at which the link ends. In the case of our assist network the first column will contain all assister node IDs and the second column will contain all shooter node IDs. The subsequent columns in the network links dataframe will be used to store any link attributes that we will need for plotting or analysis. For our assist network we will bring in the following attributes:</p>
<ul>
<li><strong>assister_shooter_freq</strong> - indicates the number of times the assister-shooter combination occurred within the game being analyzed.</li>
<li><strong>assister_shooter_freq_label</strong> - takes the number of times the assister-shooter combination occurred within the game and replaces any frequencies equal to one with a blank. This will be used to label each link and avoids unnecessary labeling.</li>
</ul>
<p>Below is the code to create the network nodes dataframe:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>penn_assister_shooter_combo <span class="ot">&lt;-</span> penn_ntwk_data <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(assister, shooter) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(assister, shooter) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">assister_shooter_freq =</span> n) <span class="co">#%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(assister_shooter_freq &gt; 1)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>penn_ntwk_links <span class="ot">&lt;-</span> penn_ntwk_data <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(assister, shooter) <span class="sc">%&gt;%</span> <span class="co">#gather all connections between assisters and shooters</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., penn_assister_shooter_combo, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"assister"</span>, <span class="st">"shooter"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">assister_shooter_freq_label =</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">if_else</span>(assister_shooter_freq <span class="sc">==</span> <span class="dv">1</span>, <span class="st">""</span>, </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.character</span>(assister_shooter_freq))) <span class="co">#%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(assister_shooter_freq = replace_na(assister_shooter_freq, 0))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Network Links are ready to go! Now we can create our network object.</p>
</section>
<section id="nodes-links-network" class="level3">
<h3 class="anchored" data-anchor-id="nodes-links-network">Nodes + Links = Network</h3>
<p>Now that we have prepared our network nodes and links, our network object can be created. This is where the <code>igraph</code> package comes in. We will use the <code>igraph::graph_from_data_frame()</code> function to form the network object. The network links dataframe is supplied to the <em>d</em> argument and the network nodes dataframe to the <em>vertices</em> argument. As discussed in the network links section, we want to show the direction of our network links so we set the <em>directed</em> argument to <em>TRUE</em>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>penn_ntwk <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d=</span>penn_ntwk_links, <span class="at">vertices=</span>penn_ntwk_nodes, <span class="at">directed=</span>T) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Our network is ready to be plotted!</p>
</section>
</section>
<section id="plot-network" class="level2">
<h2 class="anchored" data-anchor-id="plot-network">Plot Network</h2>
<p>So far, we have * brought in our assist data * chosen a game to analyze * prepared the data * created our <code>igraph</code> network object.</p>
<p>We can now plot our network and see the assist network for Penn during the Princeton-Penn game from March 19<sup>th</sup>, 2022. There is network graphing functionality contained within the <code>igraph</code> package (helpful tutorial is <a href="https://kateto.net/sunbelt2019#introduction-network-visualization">here</a>). However, I am an avid fan of the tidyverse who is used to and comfortable with <code>ggplot2</code> and the ability to build plots layer by layer. So, I was delighted to discover the <a href="https://cran.r-project.org/web/packages/ggraph/index.html"><code>ggraph</code></a> package that is designed to bring the same flexible approach to building up plots layer by layer and apply it to visualizing networks. For the purposes of this post, we will be plotting our network with <code>ggraph</code>. I recommend exploring the plotting mechanisms in <code>igraph</code> as well if you have the time.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Users of <code>ggplot2</code> will find the following method of building our plot layer by layer familiar and comfortable. For those not as familiar, I expect it will also be relatively easy to follow along with and will hopefully inspire you to dive head first into the R/tidyverse pool. Our plot will be composed of the following layers:</p>
<ul>
<li>Base Layer - plot object using <code>ggraph::ggraph()</code></li>
<li>Node Layer - using <code>ggraph::geom_node_point()</code></li>
<li>Links Layer - using <code>ggraph::geom_edge_arc()</code></li>
<li>Node Label Layer - using <code>ggraph::geom_node_text()</code></li>
<li>Styling Layer - using common <code>ggplot2</code> styling functions</li>
</ul>
<p>The only network specific data attributes we are missing in our network object are the colors that we want our nodes and links to be in the plot. We will use the <code>teamcolors</code> package to provide the hexcodes for Penn’s primary and secondary colors.</p>
<section id="base-layer" class="level3">
<h3 class="anchored" data-anchor-id="base-layer">Base Layer</h3>
<p>We begin our netwok plot assembly by initializing the plot with the <code>ggraph()</code> function. Our <code>igraph</code> network object is supplied to the first argument of the function. Then we specify the network plot layout we would like to use. Take a look at the <a href="https://www.rdocumentation.org/packages/ggraph/versions/2.0.5/topics/ggraph"><code>ggraph()</code></a> documentation for a list of layout options. For our Penn Assist Network plot we chose the “kk” layout from the igraph layout library. The “kk” layout uses the spring-based algorithm by Kamada and Kawai to place nodes. The key requirement for our node layout is that all nodes are well spaced out. After playing with different layouts, the “kk” looked to give us a visually appealing spread of nodes across a variety of assist networks. I encourage you to try a few out and find the one that suits your needs the best.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>penn_ntwk_plot <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(penn_ntwk, <span class="at">layout =</span> <span class="st">"kk"</span>) </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>penn_ntwk_plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As expected, we see that the initialization of the plot object does not render any actual plot elements. We will add them layer by layer.</p>
</section>
<section id="node-layer" class="level3">
<h3 class="anchored" data-anchor-id="node-layer">Node Layer</h3>
<p>Now that our plot object is initialized, we can start adding plot attributes. First, we want to draw in our network nodes using <code>ggraph::geom_node_point()</code>. For the size of the nodes we will use the number of assists the player recorded. Since the number of assists a given player could have in a game is relatively small, we add a weight to the size input. This allows the nodes to be more visible while maintaining the visual indicator of whether a player had more or less assists than other players on their team. We use the filled in circle shape for our node and set the fill color to Penn’s secondary color using the <code>teamcolors</code> package.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>penn_ntwk_plot <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(penn_ntwk, <span class="at">layout =</span> <span class="st">"kk"</span>) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>( <span class="co"># add nodes to the plot</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">size =</span> num_assists <span class="sc">+</span> <span class="dv">50</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> teamcolors<span class="sc">::</span><span class="fu">team_pal</span>(<span class="st">"Penn"</span>, <span class="dv">2</span>), <span class="co">#sets nodes color to Penn's secondary color</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>penn_ntwk_plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Our nodes are now drawn in, put at this point our plot does not show anything useful.</p>
</section>
<section id="links-layer" class="level3">
<h3 class="anchored" data-anchor-id="links-layer">Links Layer</h3>
<p>With our nodes in place, it is time to draw the links between them using <code>ggraph::geom_edge_arc()</code>! There are a few different <code>geom_edge_*</code> options in the <code>ggraph</code> package. We chose the geom that uses an arced line to draw the links, as this option gave us the cleanest visual. The endpoint of our link will have an arrow on it to help denote the direction of the link, as we have established the importance of that detail in the context of an assist network. The strength of the link refers to the bend of the curve. The color of the link is set to Penn’s primary color using the <code>teamcolors</code> package. Another important detail is the link label, as we have decided to draw a single link between nodes regardless of the number of links that exist between the nodes. Our link label will denote the number of links between the nodes or in our context the number of times player x assisted player y. We will also draw a thicker arc between nodes where there are multiple links to provide a visual context to the relationship between nodes (thicker arc = more assists between players).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>penn_ntwk_plot <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(penn_ntwk, <span class="at">layout =</span> <span class="st">"kk"</span>) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>( <span class="co"># add nodes to the plot</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">size =</span> num_assists <span class="sc">+</span> <span class="dv">50</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> teamcolors<span class="sc">::</span><span class="fu">team_pal</span>(<span class="st">"Penn"</span>, <span class="dv">2</span>), <span class="co">#sets nodes color to Penn's secondary color</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_arc</span>( <span class="co">#add links to the plot</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">'mm'</span>), <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_cap =</span> <span class="fu">circle</span>(<span class="dv">2</span>, <span class="st">'mm'</span>),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_cap =</span> <span class="fu">circle</span>(<span class="dv">4</span>, <span class="st">'mm'</span>),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">strength =</span> <span class="fl">0.15</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> teamcolors<span class="sc">::</span><span class="fu">team_pal</span>(<span class="st">"Penn"</span>, <span class="dv">1</span>), <span class="co">#sets links color to Penn's primary color</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> assister_shooter_freq_label,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">edge_width =</span> assister_shooter_freq),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>penn_ntwk_plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now our plot is starting to take shape!</p>
</section>
<section id="node-label-layer" class="level3">
<h3 class="anchored" data-anchor-id="node-label-layer">Node Label Layer</h3>
<p>Our nodes and our links are drawn in and we can see the shape of our network. However, we have no context on any of our network interactions. We want to know which player assisted which shooter. So, we will use <code>ggraph::geom_node_text()</code> to add labels to our nodes by assigning player names to the label argument. We can specify the size and color of the label as well as the position of the label in relation to the node using nude-x and nudge_y. It takes a bit of trail and error to get the label alignment just right, so that most every label is easy to read and easily marks the correct node.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>penn_ntwk_plot <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(penn_ntwk, <span class="at">layout =</span> <span class="st">"kk"</span>) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>( <span class="co"># add nodes to the plot</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">size =</span> num_assists <span class="sc">+</span> <span class="dv">50</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> teamcolors<span class="sc">::</span><span class="fu">team_pal</span>(<span class="st">"Penn"</span>, <span class="dv">2</span>), <span class="co">#sets nodes color to Penn's secondary color</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_arc</span>( <span class="co">#add links to the plot</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">'mm'</span>), <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_cap =</span> <span class="fu">circle</span>(<span class="dv">2</span>, <span class="st">'mm'</span>),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_cap =</span> <span class="fu">circle</span>(<span class="dv">4</span>, <span class="st">'mm'</span>),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">strength =</span> <span class="fl">0.15</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> teamcolors<span class="sc">::</span><span class="fu">team_pal</span>(<span class="st">"Penn"</span>, <span class="dv">1</span>), <span class="co">#sets links color to Penn's primary color</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> assister_shooter_freq_label,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">edge_width =</span> assister_shooter_freq),</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>( <span class="co"># add node labels to plot</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> player_name),</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray50"</span>,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#repel = T,</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.05</span>,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.35</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>penn_ntwk_plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Our plot now has the necessary context!</p>
</section>
<section id="styling-layer-full-plot" class="level3">
<h3 class="anchored" data-anchor-id="styling-layer-full-plot">Styling Layer &amp; Full Plot</h3>
<p>Now that our plot is fully constructed, we want to clean it up a bit. First, we add scales to smooth the look of our nodes and links. Next, we add titles and captions (always cite your data source!) to describe the key details of the plot.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>penn_ntwk_plot <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(penn_ntwk, <span class="at">layout =</span> <span class="st">"kk"</span>) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>( <span class="co"># add nodes to the plot</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">size =</span> num_assists <span class="sc">+</span> <span class="dv">50</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> teamcolors<span class="sc">::</span><span class="fu">team_pal</span>(<span class="st">"Penn"</span>, <span class="dv">2</span>), <span class="co">#sets nodes color to Penn's secondary color</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_arc</span>( <span class="co">#add links to the plot</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">'mm'</span>), <span class="at">type =</span> <span class="st">"closed"</span>),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_cap =</span> <span class="fu">circle</span>(<span class="dv">2</span>, <span class="st">'mm'</span>),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_cap =</span> <span class="fu">circle</span>(<span class="dv">4</span>, <span class="st">'mm'</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">strength =</span> <span class="fl">0.15</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> teamcolors<span class="sc">::</span><span class="fu">team_pal</span>(<span class="st">"Penn"</span>, <span class="dv">1</span>), <span class="co">#sets links color to Penn's primary color</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> assister_shooter_freq_label,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">edge_width =</span> assister_shooter_freq),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>( <span class="co"># add node labels to plot</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> player_name),</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray50"</span>,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#repel = T,</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.05</span>,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.35</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_width_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data: @laxreference | Plot: @danovertoom"</span>,</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Penn Assist Network"</span>,</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Penn vs.Princeton 2022-03-19"</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">22</span>),</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>penn_ntwk_plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can clearly see that Sam Handley was the focal point of the Penn offense in this game with 3 goals and 8 assists. The Handley-Rubin connection was particularly effective, with Rubin (7G, 2A) scoring 5 times off of Handley passes and resulting in six total assisted goals between the two. Dylan Gregar was the third major offensive contributor (2G, 3A) with all of his points coming from assist interactions.</p>
<p>Now that our network plot is complete and analyzed, it is ready to be shared! It is common that we would want a PNG image file of the network plot, so it can easily be shared (tweeted). We will use ggsave() to create the file and save it somewhere useful.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"plots/penn_princeton_ntwk_2022_03_19.png"</span>, <span class="at">plot =</span> penn_ntwk_plot, <span class="at">dpi =</span> <span class="dv">800</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>With our plot saved, we can now use it pretty much anywhere - like as the preview image for this blog post!</p>
</section>
</section>
</section>
<section id="function-workflow-examples" class="level1">
<h1>Function Workflow &amp; Examples</h1>
<p>In this post we have laid out how to create an assist network plot from gathering and cleaning the data to creating the network and plot using <code>igraph</code> and <code>ggraph</code>. Assist Networks are a visualiztiuon that we would likely want to create often for a given game. Since there are a lot of NCAA lacrosse games in a given season, we want this workflow to be as quick and easy as possible. Since, the steps are relatively simple and can be relatively plug and play for any team or game this is a great process to wrap into a series of functions that we can easily feed game data into.</p>
<p>The workflow consists of three sets of functions. First, we will use a set of “cleaning” functions to load and prepare our data to be used in an assist network.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>players_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data_players_2022.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_player_data</span>()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>teams_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data_teams.csv"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>games_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data_games_2022.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_games_data</span>(., teams_data)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>assist_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data_assists_2022.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_assist_data</span>(., players_data, games_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Next, we define our game and team information for the assist network we want to create.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>game_home_team <span class="ot">&lt;-</span> <span class="st">"High Point"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>game_away_team <span class="ot">&lt;-</span> <span class="st">"North Carolina"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>game_date <span class="ot">&lt;-</span> <span class="st">"2022-03-20"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>game_assist_team <span class="ot">&lt;-</span> <span class="st">"away"</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>game_assist_ntwk_tm <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(game_assist_team <span class="sc">==</span> <span class="st">"home"</span>, game_home_team, game_away_team)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then, we use a set of “network” functions to form our network object.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get network data for a specific game</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>game_ntwk_data <span class="ot">&lt;-</span> <span class="fu">get_network_data_game</span>(assist_data, game_home_team, game_away_team, game_date, game_assist_team)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#gather network nodes</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>game_ntwk_nodes <span class="ot">&lt;-</span> <span class="fu">get_network_nodes</span>(game_ntwk_data)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#gather network links</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>game_ntwk_links <span class="ot">&lt;-</span> <span class="fu">get_network_links</span>(game_ntwk_data)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#create network object for specific game selected above</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>game_curr_ntwk <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d=</span>game_ntwk_links, <span class="at">vertices=</span>game_ntwk_nodes, <span class="at">directed=</span>T)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now we finish our workflow with a set of “plotting” functions to draw our assist network.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot network</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>game_curr_ntwk_plot <span class="ot">&lt;-</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">base_ntwk_plot_game</span>(game_curr_ntwk, teamcolors<span class="sc">::</span><span class="fu">team_pal</span>(<span class="st">"North Carolina"</span>, <span class="dv">1</span>), teamcolors<span class="sc">::</span><span class="fu">team_pal</span>(<span class="st">"North Carolina"</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ntwk_node_label</span>(<span class="st">"gray50"</span>, <span class="fl">0.2</span>,<span class="sc">-</span><span class="fl">0.18</span>) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Data: @laxreference | Plot: @danovertoom"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(game_assist_ntwk_tm, <span class="st">"Assist Network"</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(game_away_team, <span class="st">"vs."</span>, game_home_team, game_date)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">22</span>),</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>game_curr_ntwk_plot</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"plots/"</span>, game_date, <span class="st">"_"</span>, game_home_team, <span class="st">"_"</span>, game_away_team, <span class="st">".png"</span>), <span class="at">plot =</span> game_curr_ntwk_plot, <span class="at">dpi =</span> <span class="dv">800</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>With the function workflow in place we can change the game/team information to quickly and easily create as many assist networks as we need or want! So here is a small dump of assist networks from the beginning of the 2022 season:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="plots/2022-02-23_Virginia_Boston_College.png" class="img-fluid figure-img"></p>
<figcaption>The assist network of Boston College’s 22-15 win over Virginia on February 23<sup>rd</sup>, 2022 shows (and indirectly shows) a lot about their offensive structure. From the plot we can see that their passing offense lead to productive days for Caitlynn Mossman (%G all assisted), Jenn Medjid (4G, 2 assisted), znd Cassidy Weeks (2G, both assisted).The indirect takeaway about Charlotte North (6G, all unassisted). This game’s assist network confirms what the lacrosse world already knows about her style of play - she is a ball dominant player that creates her own scoring opportunities (often a lot of them!).</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="plots/2022-03-08_Fairfield_Quinnipiac.png" class="img-fluid figure-img"></p>
<figcaption>An interesting assist distribution for Fairfield in their game vs.&nbsp;Quinnipiac on March 8<sup>th</sup>, 2022. Fairfield’s offense featured three distributor players (Paparozzi, Borda and Ford) with two main receiptients (Strough and McKenna). All 5 of Strough’s goals were assited and 4 of McKenna’s 5 goals were assisted. Fairfield’s offensive production was focused heavily in this group of six players (accounted for 71.4% of their goals), but it was effective in earning them a 14-10 win.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="plots/2022-03-23_High Point_North_Carolina.png" class="img-fluid figure-img"></p>
<figcaption>North Carolina had a strong offensive showing in their 23-9 win against High Point on March 23<sup>rd</sup>, 2022. The offense flowed through Jamie Ortega (who tallied her 400<sup>th</sup> career point in this game), Caitlyn Wurzburger (4G, 2A) and Scottie Rose Growney (3G, 3A).</figcaption>
</figure>
</div>
</section>
<section id="so-now-what" class="level1">
<h1>So Now What?</h1>
<p>Now that we know what assist networks are and how to create them, what is next? I am excited to explore assist networks both within a current NCAA lacrosse season, but also taking a look back at historical seasons. I believe that assist networks can be a valuable exploratory analysis tool, that allows us to ask deeper questions. Assist networks also hold value in digesting the results of games week to week and serve as an analytical check on observations that come from watching a game either in person or on film. In regards to making these visualizations and analysis more accessible to the lacrosse community as a whole, I plan to continue to develp methods of providing quick and easy access to assist networks. One thought is to wrap the assist network functions in an R package. This may also lead me to build my first shiny application….stay tuned.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{overtoom2022,
  author = {Overtoom, Dan},
  title = {Visualizing {Assist} {Networks} in {Lacrosse}},
  date = {2022-08-12},
  url = {https://danalytics.blog/posts/2022-08-12-visualizing-assist-networks-in-lacrosse/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-overtoom2022" class="csl-entry quarto-appendix-citeas" role="listitem">
Overtoom, Dan. 2022. <span>“Visualizing Assist Networks in
Lacrosse.”</span> August 12, 2022. <a href="https://danalytics.blog/posts/2022-08-12-visualizing-assist-networks-in-lacrosse/">https://danalytics.blog/posts/2022-08-12-visualizing-assist-networks-in-lacrosse/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/danalytics\.blog");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>